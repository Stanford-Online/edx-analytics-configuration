---

- name: Collect Hadoop metrics
  hosts: "mr_{{ name }}_master" # This is a special name that is generated by our ec2.py inventory plugin.
  gather_facts: False
  vars:
    - analytics_root: /var/lib/analytics-tasks/automation # "automation" may change in the future (it should match --remote-name in run-automated-task.sh)
    - analytics_scripts: "{{ analytics_root }}/repo/scripts"
    - analytics_config: "{{ analytics_root }}/config/analytics-tasks"
  tasks:
    - name: run script
      command: "{{ analytics_root }}/venv/bin/python {{ analytics_scripts }}/collect-hadoop-metrics.py {{ analytics_config }}/collect-hadoop-metrics.yaml"
      register: collection
    - name: print script output
      debug:
        msg: "{{ collection.stdout_lines }}"
